# üöÄ BizEase UAE - Complete Deployment Guide

This guide will walk you through deploying your BizEase UAE application to production.

---

## üìã Table of Contents

1. [Application Overview](#application-overview)
2. [Pre-Deployment Checklist](#pre-deployment-checklist)
3. [Database Preparation](#-database-preparation)
4. [Database Hosting Options](#-database-hosting-options)
5. [Environment Variables](#environment-variables)
6. [Deployment Options](#deployment-options)
   - **üí∞ Want to deploy for $0?** See [DEPLOY_FOR_FREE.md](./DEPLOY_FOR_FREE.md) for complete free deployment guide!
   - [Option 1: Vercel (Frontend) + Railway (Backend) - Recommended](#option-1-vercel-frontend--railway-backend---recommended)
   - [Option 2: Vercel (Frontend) + Render (Backend)](#option-2-vercel-frontend--render-backend)
   - [Option 3: AWS Deployment](#option-3-aws-deployment)
   - [Option 4: Azure Deployment](#option-4-azure-deployment)
   - [Option 5: VPS Deployment (DigitalOcean, Linode, etc.)](#option-5-vps-deployment-digitalocean-linode-etc)
7. [Post-Deployment Verification](#post-deployment-verification)
8. [Troubleshooting](#troubleshooting)

---

## üì± Application Overview

Your application consists of:

- **Frontend**: React application (in `client/` folder)
- **Backend**: Express.js API server (in `server/` folder)
- **Database**: SQL Server
- **Authentication**: Firebase Authentication
- **File Storage**: Local `uploads/` folder (consider cloud storage for production)

---

## ‚úÖ Pre-Deployment Checklist

Before deploying, ensure you have:

- [x] **Firebase Project** configured with Authentication enabled
- [ ] **Firebase Service Account Key** downloaded (JSON file)
- [ ] **SQL Server Database** hosted and accessible (see [Database Hosting Options](#-database-hosting-options))
- [ ] **Database connection details** ready (host, port, name, username, password)
- [ ] **Domain name** (optional but recommended)
- [ ] **SSL Certificate** (usually provided by hosting platform)
- [ ] **GitHub Repository** with your code pushed
- [ ] **Environment Variables** documented and ready
- [ ] **Database prepared** (test data cleared or production database created)

---

## üóÑÔ∏è Database Preparation

### **Should You Clear Test Data?**

**Yes, you should clear test data before production deployment** for the following reasons:

1. **Data Integrity**: Test data can cause confusion and errors in production
2. **Security**: Test data may contain sensitive information or test credentials
3. **Performance**: Clean database ensures optimal performance
4. **Professionalism**: Production should start with clean, real data only

### **Options for Database Setup**

#### **Option 1: Clear Test Data from Existing Database (Recommended for Same DB)**

If you're using the same database for production:

1. **Backup your database first** (critical step!)
   ```sql
   -- Create a backup before clearing
   BACKUP DATABASE bizease TO DISK = 'C:\Backups\bizease_pre_production.bak';
   ```

2. **Clear test data** (be careful - this is destructive!)
   ```sql
   -- Clear test sales
   DELETE FROM Sales WHERE companyId = 1; -- Adjust companyId as needed
   
   -- Clear test inventory (optional - you might want to keep some items)
   DELETE FROM InventoryItems WHERE companyId = 1;
   
   -- Clear test users (keep your admin account!)
   DELETE FROM Users WHERE email LIKE '%test%' OR email LIKE '%example%';
   -- OR keep only specific users:
   -- DELETE FROM Users WHERE id NOT IN (1, 2, 3); -- Keep your admin IDs
   ```

3. **Reset auto-increment counters** (optional, for clean IDs)
   ```sql
   DBCC CHECKIDENT ('Sales', RESEED, 0);
   DBCC CHECKIDENT ('InventoryItems', RESEED, 0);
   ```

#### **Option 2: Create a Fresh Production Database (Recommended)**

**Best practice**: Create a separate production database:

1. **Create new database**
   ```sql
   CREATE DATABASE bizease_production;
   ```

2. **Run schema creation scripts** (if you have them)
   - Or let the application create tables on first run

3. **Migrate only essential data** (if needed)
   - Company information
   - Admin users
   - Configuration settings

4. **Update environment variables** to point to production database

#### **Option 3: Keep Minimal Test Data**

If you want some sample data for initial testing:

1. **Keep only essential test data**:
   - 1-2 sample inventory items
   - 1-2 sample sales (for testing reports)
   - Remove all other test data

2. **Mark test data clearly**:
   ```sql
   -- Add a note or flag to identify test data
   UPDATE InventoryItems SET notes = 'TEST DATA - REMOVE BEFORE PRODUCTION' WHERE companyId = 1;
   ```

### **What to Keep vs. Remove**

**‚úÖ Keep:**
- Your admin user account(s)
- Company configuration
- Any real business data
- Database schema/structure

**‚ùå Remove:**
- Test sales transactions
- Test inventory items (or keep minimal samples)
- Test user accounts (except admin)
- Any data generated by test scripts (`generate-sales-test.js`, `generate-inventory-items.js`)

### **Scripts to Help Clean Test Data**

If you have test data generated by scripts, you can create a cleanup script:

```javascript
// scripts/clear-test-data.js
const { sequelize } = require('../server/config/database');
const Sale = require('../models/Sale');
const InventoryItem = require('../models/InventoryItem');

async function clearTestData() {
  try {
    await sequelize.authenticate();
    
    // Clear test sales
    const deletedSales = await Sale.destroy({
      where: { companyId: 1 } // Adjust as needed
    });
    console.log(`‚úÖ Deleted ${deletedSales} test sales`);
    
    // Clear test inventory (optional)
    // const deletedItems = await InventoryItem.destroy({
    //   where: { companyId: 1 }
    // });
    // console.log(`‚úÖ Deleted ${deletedItems} test inventory items`);
    
    console.log('‚úÖ Test data cleared successfully');
  } catch (error) {
    console.error('‚ùå Error clearing test data:', error);
  } finally {
    await sequelize.close();
  }
}

clearTestData();
```

### **‚ö†Ô∏è Important Notes**

- **Always backup before clearing data** - You cannot undo deletions!
- **Test your cleanup script** on a copy of the database first
- **Verify your admin account** still exists after cleanup
- **Check foreign key constraints** - Some data might be protected by relationships
- **Consider using transactions** - Wrap cleanup in a transaction so you can rollback if needed

---

## üóÑÔ∏è Database Hosting Options

**Important**: Your SQL Server database needs to be hosted somewhere accessible from your backend deployment platform. Here are your options:

### **Option 1: Azure SQL Database (Recommended for Cloud)**

**Best for**: Production deployments, especially if using Azure for backend

**Pros:**
- Fully managed SQL Server
- Automatic backups and high availability
- Scales automatically
- Built-in security features
- Easy to set up

**Cons:**
- Costs more than self-hosted
- Requires Azure account

**Setup Steps:**

1. **Create Azure SQL Database**
   - Go to [Azure Portal](https://portal.azure.com)
   - Click "Create a resource" ‚Üí Search "SQL Database"
   - Click "Create"
   - Fill in:
     - **Database name**: `bizease-prod`
     - **Server**: Create new server
     - **Server name**: `bizease-sql-server` (must be unique)
     - **Location**: Choose closest to your backend
     - **Authentication**: SQL authentication
     - **Admin username**: `bizeaseadmin`
     - **Password**: (create strong password)
     - **Compute + storage**: Start with Basic tier ($5/month) or General Purpose

2. **Configure Firewall**
   - After creation, go to your SQL server
   - Click "Networking" ‚Üí "Public access"
   - Add firewall rules:
     - **Allow Azure services**: Yes
     - **Add your IP**: Click "Add client IP"
     - **Add backend platform IPs**: (Railway, Render, etc. - see below)

3. **Get Connection String**
   - Go to your database ‚Üí "Connection strings"
   - Copy the connection details:
     - **Server**: `bizease-sql-server.database.windows.net`
     - **Database**: `bizease-prod`
     - **Username**: `bizeaseadmin@bizease-sql-server`
     - **Password**: (your password)

4. **Update Environment Variables**
   ```env
   DB_HOST=bizease-sql-server.database.windows.net
   DB_PORT=1433
   DB_NAME=bizease-prod
   DB_USER=bizeaseadmin@bizease-sql-server
   DB_PASSWORD=your-strong-password
   DB_ENCRYPT=true
   DB_TRUST_CERT=true
   ```

**Pricing**: ~$5-15/month for small apps (Basic tier), $15-100/month for production (General Purpose)

---

### **Option 2: AWS RDS for SQL Server**

**Best for**: Production deployments, especially if using AWS for backend

**Pros:**
- Fully managed SQL Server
- High availability options
- Automated backups
- Scales easily

**Cons:**
- More expensive than Azure SQL
- More complex setup

**Setup Steps:**

1. **Create RDS Instance**
   - Go to [AWS RDS Console](https://console.aws.amazon.com/rds/)
   - Click "Create database"
   - Choose:
     - **Engine**: SQL Server Express (cheaper) or Standard
     - **Template**: Free tier (if eligible) or Production
     - **DB instance identifier**: `bizease-db`
     - **Master username**: `admin`
     - **Master password**: (create strong password)
     - **DB instance class**: `db.t3.micro` (free tier) or `db.t3.small`
     - **Storage**: 20 GB (minimum)

2. **Configure Security**
   - **VPC**: Use default VPC
   - **Public access**: Yes (if backend is outside AWS)
   - **Security group**: Create new or use existing
   - Add inbound rule: Port 1433 from your backend IPs

3. **Get Connection Details**
   - After creation, note the **Endpoint** (e.g., `bizease-db.xxxxx.us-east-1.rds.amazonaws.com`)

4. **Update Environment Variables**
   ```env
   DB_HOST=bizease-db.xxxxx.us-east-1.rds.amazonaws.com
   DB_PORT=1433
   DB_NAME=bizease
   DB_USER=admin
   DB_PASSWORD=your-strong-password
   DB_ENCRYPT=true
   DB_TRUST_CERT=false
   ```

**Pricing**: ~$15-50/month (SQL Server Express is cheaper but limited)

---

### **Option 3: DigitalOcean Managed Databases**

**Best for**: Simple, affordable managed SQL Server

**Pros:**
- Simple pricing
- Easy to set up
- Good performance

**Cons:**
- Limited to DigitalOcean regions
- Fewer features than Azure/AWS

**Setup Steps:**

1. **Create Database**
   - Go to [DigitalOcean](https://www.digitalocean.com/products/managed-databases)
   - Click "Create Database"
   - Choose:
     - **Database Engine**: SQL Server
     - **Plan**: Basic ($15/month) or Professional
     - **Region**: Choose closest to backend
     - **Database name**: `bizease`

2. **Get Connection Details**
   - After creation, go to "Connection Details"
   - Note: Host, Port, Username, Password

3. **Update Environment Variables**
   ```env
   DB_HOST=your-db-host.db.ondigitalocean.com
   DB_PORT=25060
   DB_NAME=bizease
   DB_USER=doadmin
   DB_PASSWORD=your-password
   DB_ENCRYPT=true
   DB_TRUST_CERT=true
   ```

**Pricing**: ~$15-60/month

---

### **Option 4: Self-Hosted SQL Server (VPS)**

**Best for**: Full control, cost savings, if you already have a VPS

**Pros:**
- Full control
- Can be cheaper at scale
- No vendor lock-in

**Cons:**
- You manage backups, updates, security
- More setup required
- Need to maintain server

**Setup Steps:**

1. **Install SQL Server on VPS**
   ```bash
   # On Ubuntu/Debian VPS
   curl -fsSL https://packages.microsoft.com/keys/microsoft.asc | sudo apt-key add -
   sudo add-apt-repository "$(curl -fsSL https://packages.microsoft.com/config/ubuntu/20.04/mssql-server-2019.list)"
   sudo apt-get update
   sudo apt-get install -y mssql-server
   
   # Configure SQL Server
   sudo /opt/mssql/bin/mssql-conf setup
   ```

2. **Configure Firewall**
   ```bash
   sudo ufw allow 1433/tcp
   ```

3. **Create Database**
   ```sql
   CREATE DATABASE bizease;
   CREATE LOGIN bizeaseuser WITH PASSWORD = 'your-strong-password';
   USE bizease;
   CREATE USER bizeaseuser FOR LOGIN bizeaseuser;
   ALTER ROLE db_owner ADD MEMBER bizeaseuser;
   ```

4. **Update Environment Variables**
   ```env
   DB_HOST=your-vps-ip-address
   DB_PORT=1433
   DB_NAME=bizease
   DB_USER=bizeaseuser
   DB_PASSWORD=your-strong-password
   DB_ENCRYPT=false
   DB_TRUST_CERT=false
   ```

**Pricing**: VPS cost (~$5-20/month) + your time

---

### **Option 5: Keep Existing Database (If Already Hosted)**

If you already have a SQL Server database hosted somewhere:

1. **Verify Accessibility**
   - Ensure database is accessible from the internet (or VPN)
   - Check firewall allows connections from your backend platform

2. **Get Connection Details**
   - Host/IP address
   - Port (usually 1433)
   - Database name
   - Username and password

3. **Update Environment Variables**
   ```env
   DB_HOST=your-existing-db-host
   DB_PORT=1433
   DB_NAME=your-database-name
   DB_USER=your-username
   DB_PASSWORD=your-password
   DB_ENCRYPT=true  # or false, depending on your setup
   DB_TRUST_CERT=false  # or true, depending on SSL setup
   ```

---

### **üîí Security Best Practices**

Regardless of which option you choose:

1. **Use Strong Passwords**: Minimum 16 characters, mix of letters, numbers, symbols
2. **Enable Encryption**: Set `DB_ENCRYPT=true` in production
3. **Restrict Access**: Only allow connections from your backend IPs
4. **Regular Backups**: Set up automated backups (managed services do this automatically)
5. **Monitor Access**: Review connection logs regularly

---

### **üåê Allowing Backend Platforms to Connect**

Your database needs to allow connections from your backend hosting platform:

**Railway:**
- Railway uses dynamic IPs
- You may need to allow all IPs (0.0.0.0/0) temporarily, or use Railway's static IP feature
- Or use a managed database that allows all Azure services

**Render:**
- Similar to Railway - dynamic IPs
- May need to allow all IPs or use static IP

**VPS:**
- Add your VPS IP to database firewall rules

**Azure:**
- If using Azure SQL, enable "Allow Azure services" in firewall rules

---

### **üí∞ Cost Comparison**

| Option | Monthly Cost | Best For |
|--------|-------------|----------|
| Azure SQL (Basic) | $5-15 | Small apps, Azure users |
| Azure SQL (General Purpose) | $15-100 | Production apps |
| AWS RDS (SQL Express) | $15-50 | AWS users |
| DigitalOcean Managed | $15-60 | Simple, affordable |
| Self-Hosted VPS | $5-20 + time | Full control, cost savings |

**Recommendation**: Start with **Azure SQL Database (Basic tier)** - it's the easiest and most cost-effective for most users.

---

## üîê Environment Variables

### Frontend Environment Variables (`.env` in `client/` folder)

Create a `.env` file in the `client/` folder:

```env
# Firebase Configuration
REACT_APP_FIREBASE_API_KEY=your-firebase-api-key
REACT_APP_FIREBASE_AUTH_DOMAIN=your-project.firebaseapp.com
REACT_APP_FIREBASE_PROJECT_ID=your-project-id
REACT_APP_FIREBASE_STORAGE_BUCKET=your-project.appspot.com
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=123456789
REACT_APP_FIREBASE_APP_ID=1:123456789:web:abcdef

# API Base URL (Production)
REACT_APP_API_BASE_URL=https://your-backend-domain.com/api
```

### Backend Environment Variables (`.env` in root folder)

Create a `.env` file in the root folder:

```env
# Server Configuration
PORT=5004
NODE_ENV=production

# SQL Server Database
DB_HOST=your-sql-server-host
DB_PORT=1433
DB_NAME=bizease
DB_USER=your-db-username
DB_PASSWORD=your-strong-password
DB_ENCRYPT=true
DB_TRUST_CERT=false

# CORS Configuration
CLIENT_URL=https://your-frontend-domain.com
# OR for multiple origins:
CLIENT_URLS=https://your-frontend-domain.com,https://www.your-frontend-domain.com

# Firebase Admin (Service Account)
# Option 1: JSON as environment variable (recommended for cloud platforms)
FIREBASE_SERVICE_ACCOUNT={"type":"service_account","project_id":"..."}

# Option 2: Path to service account file (for VPS deployments)
FIREBASE_SERVICE_ACCOUNT_PATH=./firebase-service-account.json

# Email Configuration (Optional - for alerts)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
```

---

## üåê Deployment Options

### Option 1: Vercel (Frontend) + Railway (Backend) - Recommended

This is the easiest and most cost-effective option for most users.

#### **üí∞ Pricing Overview**

**Vercel (Frontend):**
- **Free Tier (Hobby):**
  - Unlimited personal projects
  - 100GB bandwidth per month
  - Automatic SSL certificates
  - Custom domains
  - Perfect for most small to medium applications
  - **Cost: FREE** ‚úÖ

- **Pro Tier ($20/month):**
  - Everything in Hobby
  - 1TB bandwidth per month
  - Team collaboration
  - Advanced analytics
  - Priority support
  - Only needed for high-traffic or team projects

**Railway (Backend):**
- **Free Trial:**
  - $5 credit per month (free for first month)
  - Enough for testing and small applications
  - **Cost: FREE for first month** ‚úÖ

- **Starter Plan ($5/month):**
  - $5 credit included
  - Pay-as-you-go for usage beyond credit
  - ~$0.000463 per GB RAM-hour
  - ~$0.000231 per GB storage-month
  - Typical small app: **$5-10/month** (often stays within free credit)

- **Pro Plan ($20/month):**
  - $20 credit included
  - Better for production apps with more traffic
  - Priority support
  - Team features

**Total Estimated Cost:**
- **Starting out:** **FREE** (Vercel Hobby + Railway free trial)
- **Small application:** **$5-10/month** (Vercel Hobby + Railway Starter)
- **Medium application:** **$20-30/month** (Vercel Hobby + Railway Pro)
- **Large application:** **$40-50/month** (Vercel Pro + Railway Pro)

**Note:** For most BizEase UAE deployments, you'll likely stay in the **FREE to $10/month** range, making this the most cost-effective option.

#### **Step 1: Deploy Frontend to Vercel**

1. **Push your code to GitHub** (if not already done)
   ```bash
   git add .
   git commit -m "Ready for deployment"
   git push origin main
   ```

2. **Go to [Vercel.com](https://vercel.com)** and sign up/login

3. **Import your GitHub repository**
   - Click "New Project"
   - Select your repository
   - Configure the project:
     - **Framework Preset**: Create React App
     - **Root Directory**: `client`
     - **Build Command**: `npm run build`
     - **Output Directory**: `build`
     - **Install Command**: `npm install`

4. **Add Environment Variables** in Vercel dashboard:
   - Go to Project Settings ‚Üí Environment Variables
   - Add all `REACT_APP_*` variables from your frontend `.env`
   - Make sure to set them for "Production" environment

5. **Deploy**
   - Click "Deploy"
   - Wait for build to complete
   - Note your deployment URL (e.g., `https://your-app.vercel.app`)

#### **Step 2: Deploy Backend to Railway**

1. **Go to [Railway.app](https://railway.app)** and sign up/login

2. **Create a New Project**
   - Click "New Project"
   - Select "Deploy from GitHub repo"
   - Select your repository

3. **Configure the Service**
   - Railway will auto-detect Node.js
   - Set **Root Directory**: `server`
   - Set **Start Command**: `npm start`
   - Set **Build Command**: `npm install`

4. **Add Environment Variables**
   - Go to Variables tab
   - Add all backend environment variables:
     - `PORT` (Railway will set this automatically, but you can override)
     - `NODE_ENV=production`
     - `DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASSWORD`
     - `DB_ENCRYPT=true`
     - `DB_TRUST_CERT=false`
     - `CLIENT_URL=https://your-vercel-app.vercel.app`
     - `FIREBASE_SERVICE_ACCOUNT` (paste entire JSON as string)

5. **Get Your Backend URL**
   - Railway will provide a URL like `https://your-app.up.railway.app`
   - Update your frontend `REACT_APP_API_BASE_URL` in Vercel to point to this URL

6. **Update Frontend Environment Variable**
   - Go back to Vercel
   - Update `REACT_APP_API_BASE_URL` to your Railway backend URL
   - Redeploy frontend

#### **Step 3: Configure Custom Domain (Optional)**

**Frontend (Vercel):**
- Go to Project Settings ‚Üí Domains
- Add your custom domain
- Follow DNS configuration instructions

**Backend (Railway):**
- Go to Settings ‚Üí Networking
- Add custom domain
- Update CORS `CLIENT_URL` to your custom frontend domain

---

### Option 2: Vercel (Frontend) + Render (Backend)

Similar to Railway, but using Render for backend.

#### **Step 1: Deploy Frontend to Vercel**
(Same as Option 1, Step 1)

#### **Step 2: Deploy Backend to Render**

1. **Go to [Render.com](https://render.com)** and sign up/login

2. **Create a New Web Service**
   - Click "New +" ‚Üí "Web Service"
   - Connect your GitHub repository

3. **Configure the Service**
   - **Name**: `bizease-backend`
   - **Environment**: Node
   - **Root Directory**: `server`
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`

4. **Add Environment Variables**
   - Go to Environment tab
   - Add all backend environment variables (same as Railway)

5. **Get Your Backend URL**
   - Render will provide a URL like `https://your-app.onrender.com`
   - Update frontend `REACT_APP_API_BASE_URL` in Vercel

---

### Option 3: AWS Deployment

#### **Frontend: AWS S3 + CloudFront**

1. **Build your React app**
   ```bash
   cd client
   npm run build
   ```

2. **Create S3 Bucket**
   - Go to AWS S3 Console
   - Create bucket with your domain name
   - Enable static website hosting
   - Upload `build/` folder contents

3. **Create CloudFront Distribution**
   - Point to S3 bucket
   - Configure SSL certificate
   - Set up custom domain

#### **Backend: AWS Elastic Beanstalk or EC2**

**Option A: Elastic Beanstalk (Easier)**
1. Create Elastic Beanstalk application
2. Upload your `server/` folder as ZIP
3. Configure environment variables
4. Deploy

**Option B: EC2 (More Control)**
1. Launch EC2 instance (Ubuntu)
2. Install Node.js and PM2
3. Clone repository
4. Set up environment variables
5. Use PM2 to run server: `pm2 start server/index.js`

---

### Option 4: Azure Deployment

#### **Frontend: Azure Static Web Apps**

1. Go to Azure Portal
2. Create Static Web App
3. Connect GitHub repository
4. Set build configuration:
   - App location: `client`
   - Build command: `npm run build`
   - Output location: `build`

#### **Backend: Azure App Service**

1. Create App Service (Node.js)
2. Deploy from GitHub
3. Set environment variables in Configuration
4. Configure SQL Server connection

---

### Option 5: VPS Deployment (DigitalOcean, Linode, etc.)

For full control over your deployment.

#### **Step 1: Set Up VPS**

1. **Create VPS Instance**
   - Ubuntu 22.04 LTS
   - Minimum: 2GB RAM, 1 CPU
   - Recommended: 4GB RAM, 2 CPU

2. **SSH into Server**
   ```bash
   ssh root@your-server-ip
   ```

3. **Install Node.js**
   ```bash
   curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
   sudo apt-get install -y nodejs
   ```

4. **Install Nginx**
   ```bash
   sudo apt update
   sudo apt install nginx
   ```

5. **Install PM2**
   ```bash
   sudo npm install -g pm2
   ```

#### **Step 2: Deploy Application**

1. **Clone Repository**
   ```bash
   cd /var/www
   git clone https://github.com/your-username/your-repo.git bizease
   cd bizease
   ```

2. **Install Dependencies**
   ```bash
   npm run install-all
   ```

3. **Set Up Environment Variables**
   ```bash
   # Create .env file in root
   nano .env
   # Paste all backend environment variables
   
   # Create .env file in client folder
   nano client/.env
   # Paste all frontend environment variables
   ```

4. **Build Frontend**
   ```bash
   cd client
   npm run build
   cd ..
   ```

5. **Start Backend with PM2**
   ```bash
   cd server
   pm2 start index.js --name bizease-backend
   pm2 save
   pm2 startup
   ```

#### **Step 3: Configure Nginx**

1. **Create Nginx Configuration**
   ```bash
   sudo nano /etc/nginx/sites-available/bizease
   ```

2. **Add Configuration**
   ```nginx
   # Frontend (React App)
   server {
       listen 80;
       server_name your-domain.com www.your-domain.com;
       
       root /var/www/bizease/client/build;
       index index.html;
       
       location / {
           try_files $uri $uri/ /index.html;
       }
   }
   
   # Backend API
   server {
       listen 80;
       server_name api.your-domain.com;
       
       location / {
           proxy_pass http://localhost:5004;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection 'upgrade';
           proxy_set_header Host $host;
           proxy_cache_bypass $http_upgrade;
       }
   }
   ```

3. **Enable Site**
   ```bash
   sudo ln -s /etc/nginx/sites-available/bizease /etc/nginx/sites-enabled/
   sudo nginx -t
   sudo systemctl restart nginx
   ```

#### **Step 4: Set Up SSL with Let's Encrypt**

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com -d www.your-domain.com -d api.your-domain.com
```

---

## ‚úÖ Post-Deployment Verification

After deployment, verify everything works:

### 1. **Health Check**
- Visit: `https://your-backend-url/health`
- Should return: `{"status":"ok","database":{"state":"connected"}}`

### 2. **Frontend Loads**
- Visit your frontend URL
- Should see login page

### 3. **Authentication Works**
- Try logging in with Firebase
- Should redirect to dashboard

### 4. **API Calls Work**
- Open browser DevTools ‚Üí Network tab
- Make a request (e.g., load dashboard)
- Check that API calls go to your backend URL
- Verify responses are successful

### 5. **Database Connection**
- Check backend logs
- Should see: `‚úÖ SQL Server connection established successfully`

### 6. **File Uploads**
- Test uploading a file
- Verify files are saved correctly

---

## üîß Troubleshooting

### **Frontend Issues**

**Problem: Blank page or build errors**
- Check Vercel build logs
- Verify all environment variables are set
- Ensure `REACT_APP_API_BASE_URL` points to correct backend URL

**Problem: API calls failing**
- Check CORS configuration in backend
- Verify `CLIENT_URL` includes your frontend domain
- Check browser console for errors

**Problem: Firebase authentication not working**
- Verify all `REACT_APP_FIREBASE_*` variables are set
- Check Firebase console for allowed domains
- Ensure Firebase Authentication is enabled

### **Backend Issues**

**Problem: Server won't start**
- Check environment variables are set correctly
- Verify Node.js version (should be 18+)
- Check logs for specific error messages

**Problem: Database connection fails**
- Verify SQL Server is accessible from deployment platform
- Check firewall rules allow connection
- Verify database credentials
- For Azure SQL: Ensure "Allow Azure services" is enabled

**Problem: Firebase Admin errors**
- Verify `FIREBASE_SERVICE_ACCOUNT` JSON is valid
- Check service account has correct permissions
- Ensure JSON is properly escaped if using environment variable

**Problem: CORS errors**
- Verify `CLIENT_URL` or `CLIENT_URLS` includes frontend domain
- Check that frontend is making requests to correct backend URL
- Ensure credentials are included in CORS config

### **Database Issues**

**Problem: Connection timeout**
- Check SQL Server firewall allows your deployment platform IP
- Verify `DB_HOST` is correct (use IP or fully qualified domain)
- For Azure SQL: Add deployment platform IP to firewall rules

**Problem: Authentication fails**
- Verify SQL Server authentication mode (SQL Auth vs Windows Auth)
- Check username and password are correct
- Ensure user has proper permissions

---

## üìù Additional Notes

### **File Storage**

For production, consider using cloud storage instead of local `uploads/` folder:
- **AWS S3**
- **Azure Blob Storage**
- **Google Cloud Storage**
- **Cloudinary** (for images)

### **Monitoring**

Set up monitoring for production:
- **Application Monitoring**: Sentry, New Relic, or Datadog
- **Uptime Monitoring**: UptimeRobot, Pingdom
- **Log Management**: Loggly, Papertrail

### **Backup Strategy**

- **Database Backups**: Set up automated SQL Server backups
- **Code Backups**: Use Git (already done)
- **File Backups**: Backup `uploads/` folder regularly

### **Security Checklist**

- [ ] Use HTTPS everywhere
- [ ] Set strong database passwords
- [ ] Enable SQL Server encryption
- [ ] Use environment variables (never commit secrets)
- [ ] Set up rate limiting
- [ ] Enable CORS only for your domains
- [ ] Keep dependencies updated
- [ ] Use Firebase security rules

---

## üéâ You're Ready!

Your application should now be deployed and running in production. If you encounter any issues, refer to the troubleshooting section or check your deployment platform's logs.

**Need Help?**
- Check deployment platform documentation
- Review error logs
- Verify environment variables
- Test database connectivity

Good luck with your deployment! üöÄ

